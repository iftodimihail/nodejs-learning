{"version":3,"sources":["../../src/controllers/books.js"],"names":["db","api","Router","get","req","res","index","books","collection","transformer","error","post","validationRules","store","body","book","created","id","show","params","item","notFound","put","update","noContent","delete","destroy"],"mappings":"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","file":"books.js","sourcesContent":["import { Router } from 'express';\r\nimport response from '../concerns/response';\r\nimport repository from '../repositories/book';\r\nimport validate from 'express-validation';\r\nimport validationRules from '../validation/book';\r\nimport transformer from '../transformers/book';\r\n\r\nexport default (db) => {\r\n\r\n  const api = new Router();\r\n\r\n  /**\r\n   * List all resources\r\n   * @swagger\r\n   * /api/books:\r\n   *   get:\r\n   *     tags:\r\n   *       - Books\r\n   *     name: List books\r\n   *     summary: Lists all the books\r\n   *     security:\r\n   *       - bearerAuth: []\r\n   *     consumes:\r\n   *       - application/json\r\n   *     produces:\r\n   *       - application/json\r\n   *     responses:\r\n   *       200:\r\n   *         description: An array of book objects\r\n   *       401:\r\n   *         description: Not authorized to access this resource\r\n   *       422:\r\n   *         description: Unprocessable entity\r\n   */\r\n  api.get('/', async (req, res) => {\r\n    try {\r\n      const books = await repository(db).index();\r\n      return response(res).collection(books, transformer);\r\n    } catch (err) {\r\n      return response(res).error(err);\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Create a new resource\r\n   * @swagger\r\n   * /api/books:\r\n   *   post:\r\n   *     tags:\r\n   *       - Books\r\n   *     name: Create book\r\n   *     summary: Creates a new book\r\n   *     security:\r\n   *       - bearerAuth: []\r\n   *     consumes:\r\n   *       - application/json\r\n   *     produces:\r\n   *       - application/json\r\n   *     parameters:\r\n   *       - name: body\r\n   *         in: body\r\n   *         schema:\r\n   *           type: object\r\n   *           properties:\r\n   *             name:\r\n   *               type: string\r\n   *             page_no:\r\n   *               type: integer\r\n   *             read:\r\n   *               type: boolean\r\n   *         required:\r\n   *           - name\r\n   *           - page_no\r\n   *           - read\r\n   *     responses:\r\n   *       200:\r\n   *         description: A book object\r\n   *       401:\r\n   *         description: Not authorized to access this resource\r\n   *       422:\r\n   *         description: Unprocessable entity\r\n   */\r\n  api.post('/', validate(validationRules.store), async (req, res) => {\r\n    try {\r\n      const book = await repository(db).store(req.body);\r\n      return response(res).created({ id: book.id });\r\n    } catch (err) {\r\n      return response(res).error(err);\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Show an existing resource\r\n   * @swagger\r\n   * /api/books/{id}:\r\n   *   get:\r\n   *     tags:\r\n   *       - Books\r\n   *     name: Show book\r\n   *     summary: Shows an existing book\r\n   *     security:\r\n   *       - bearerAuth: []\r\n   *     consumes:\r\n   *       - application/json\r\n   *     produces:\r\n   *       - application/json\r\n   *     parameters:\r\n   *       - name: id\r\n   *         in: path\r\n   *         schema:\r\n   *           type: string\r\n   *         required:\r\n   *           - id\r\n   *     responses:\r\n   *       200:\r\n   *         description: A book object\r\n   *       401:\r\n   *         description: Not authorized to access this resource\r\n   *       422:\r\n   *         description: Unprocessable entity\r\n   */\r\n  api.get('/:id', async (req, res) => {\r\n    try {\r\n      const book = await repository(db).show(req.params.id);\r\n      if (book !== null) {\r\n        return response(res).item(book, transformer);\r\n      }\r\n      return response(res).notFound('Book not found.');\r\n    } catch (err) {\r\n      return response(res).error(err);\r\n    }\r\n\r\n  });\r\n\r\n  /**\r\n   * Update an existing resource\r\n   * @swagger\r\n   * /api/books/{id}:\r\n   *   put:\r\n   *     tags:\r\n   *       - Books\r\n   *     name: Update book\r\n   *     summary: Updates an existing book\r\n   *     security:\r\n   *       - bearerAuth: []\r\n   *     consumes:\r\n   *       - application/json\r\n   *     produces:\r\n   *       - application/json\r\n   *     parameters:\r\n   *       - name: body\r\n   *         in: body\r\n   *         schema:\r\n   *           type: object\r\n   *           properties:\r\n   *             name:\r\n   *               type: string\r\n   *         required:\r\n   *           - name\r\n   *       - name: id\r\n   *         in: path\r\n   *         schema:\r\n   *           type: string\r\n   *         required:\r\n   *           - id\r\n   *     responses:\r\n   *       204:\r\n   *         description: No content\r\n   *       401:\r\n   *         description: Not authorized to access this resource\r\n   *       422:\r\n   *         description: Unprocessable entity\r\n   */\r\n  api.put('/:id', validate(validationRules.update), async (req, res) => {\r\n    try {\r\n      await repository(db).update(req.params.id, req.body);\r\n      return response(res).noContent();\r\n    } catch (err) {\r\n      return response(res).error(err);\r\n    }\r\n  });\r\n\r\n  /**\r\n   * Destroy an existing resource\r\n   * @swagger\r\n   * /api/books/{id}:\r\n   *   delete:\r\n   *     tags:\r\n   *       - Books\r\n   *     name: Delete book\r\n   *     summary: Deletes an existing book\r\n   *     security:\r\n   *       - bearerAuth: []\r\n   *     consumes:\r\n   *       - application/json\r\n   *     produces:\r\n   *       - application/json\r\n   *     parameters:\r\n   *       - name: id\r\n   *         in: path\r\n   *         schema:\r\n   *           type: string\r\n   *         required:\r\n   *           - id\r\n   *     responses:\r\n   *       200:\r\n   *         description: A book object\r\n   *       401:\r\n   *         description: Not authorized to access this resource\r\n   */\r\n  api.delete('/:id', async (req, res) => {\r\n    try {\r\n      const book = await repository(db).destroy(req.params.id);\r\n      return response(res).item(book, transformer);\r\n    } catch (err) {\r\n      return response(res).error(err);\r\n    }\r\n  });\r\n\r\n  return api;\r\n}\r\n"]}