{"version":3,"sources":["../../src/controllers/users.js"],"names":["db","api","Router","get","req","res","index","users","collection","transformer","error","post","validationRules","store","body","user","created","id","show","params","item","notFound","put","update","noContent","delete","destroy"],"mappings":"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","file":"users.js","sourcesContent":["import { Router } from 'express';\nimport response from '../concerns/response';\nimport repository from '../repositories/user';\nimport validate from 'express-validation';\nimport validationRules from '../validation/user';\nimport transformer from '../transformers/user';\n\nexport default (db) => {\n\n  const api = new Router();\n\n  /**\n   * List all resources\n   * @swagger\n   * /api/users:\n   *   get:\n   *     tags:\n   *       - Users\n   *     name: List users\n   *     summary: Lists all the users\n   *     security:\n   *       - bearerAuth: []\n   *     consumes:\n   *       - application/json\n   *     produces:\n   *       - application/json\n   *     responses:\n   *       200:\n   *         description: An array of user objects\n   *       401:\n   *         description: Not authorized to access this resource\n   *       422:\n   *         description: Unprocessable entity\n   */\n  api.get('/', async (req, res) => {\n    try {\n      const users = await repository(db).index();\n      return response(res).collection(users, transformer);\n    } catch (err) {\n      return response(res).error(err);\n    }\n  });\n\n  /**\n   * Create a new resource\n   * @swagger\n   * /api/users:\n   *   post:\n   *     tags:\n   *       - Users\n   *     name: Create user\n   *     summary: Creates a new user\n   *     security:\n   *       - bearerAuth: []\n   *     consumes:\n   *       - application/json\n   *     produces:\n   *       - application/json\n   *     parameters:\n   *       - name: body\n   *         in: body\n   *         schema:\n   *           type: object\n   *           properties:\n   *             email:\n   *               type: string\n   *             password:\n   *               type: string\n   *               format: password\n   *         required:\n   *           - email\n   *           - password\n   *     responses:\n   *       200:\n   *         description: A user object\n   *       401:\n   *         description: Not authorized to access this resource\n   *       422:\n   *         description: Unprocessable entity\n   */\n  api.post('/', validate(validationRules.store), async (req, res) => {\n    try {\n      const user = await repository(db).store(req.body);\n      return response(res).created({ id: user.id });\n    } catch (err) {\n      return response(res).error(err);\n    }\n  });\n\n  /**\n   * Show an existing resource\n   * @swagger\n   * /api/users/{id}:\n   *   get:\n   *     tags:\n   *       - Users\n   *     name: Show user\n   *     summary: Shows an existing user\n   *     security:\n   *       - bearerAuth: []\n   *     consumes:\n   *       - application/json\n   *     produces:\n   *       - application/json\n   *     parameters:\n   *       - name: id\n   *         in: path\n   *         schema:\n   *           type: string\n   *         required:\n   *           - id\n   *     responses:\n   *       200:\n   *         description: A user object\n   *       401:\n   *         description: Not authorized to access this resource\n   *       422:\n   *         description: Unprocessable entity\n   */\n  api.get('/:id', async (req, res) => {\n    try {\n      const user = await repository(db).show(req.params.id);\n      if (user !== null) {\n        return response(res).item(user, transformer);\n      }\n      return response(res).notFound('User not found.');\n    } catch (err) {\n      return response(res).error(err);\n    }\n\n  });\n\n  /**\n   * Update an existing resource\n   * @swagger\n   * /api/users/{id}:\n   *   put:\n   *     tags:\n   *       - Users\n   *     name: Update user\n   *     summary: Updates an existing user\n   *     security:\n   *       - bearerAuth: []\n   *     consumes:\n   *       - application/json\n   *     produces:\n   *       - application/json\n   *     parameters:\n   *       - name: body\n   *         in: body\n   *         schema:\n   *           type: object\n   *           properties:\n   *             email:\n   *               type: string\n   *         required:\n   *           - email\n   *       - name: id\n   *         in: path\n   *         schema:\n   *           type: string\n   *         required:\n   *           - id\n   *     responses:\n   *       204:\n   *         description: No content\n   *       401:\n   *         description: Not authorized to access this resource\n   *       422:\n   *         description: Unprocessable entity\n   */\n  api.put('/:id', validate(validationRules.update), async (req, res) => {\n    try {\n      await repository(db).update(req.params.id, req.body);\n      return response(res).noContent();\n    } catch (err) {\n      return response(res).error(err);\n    }\n  });\n\n  /**\n   * Destroy an existing resource\n   * @swagger\n   * /api/users/{id}:\n   *   delete:\n   *     tags:\n   *       - Users\n   *     name: Delete user\n   *     summary: Deletes an existing user\n   *     security:\n   *       - bearerAuth: []\n   *     consumes:\n   *       - application/json\n   *     produces:\n   *       - application/json\n   *     parameters:\n   *       - name: id\n   *         in: path\n   *         schema:\n   *           type: string\n   *         required:\n   *           - id\n   *     responses:\n   *       200:\n   *         description: A user object\n   *       401:\n   *         description: Not authorized to access this resource\n   */\n  api.delete('/:id', async (req, res) => {\n    try {\n      const user = await repository(db).destroy(req.params.id);\n      return response(res).item(user, transformer);\n    } catch (err) {\n      return response(res).error(err);\n    }\n  });\n\n  return api;\n}\n"]}